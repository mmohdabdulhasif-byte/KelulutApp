<!doctype html>
<html lang="ms">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>An-Naas Kelulut Bekeng</title>
  <meta name="theme-color" content="#FFD700">

  <!-- ✅ Betulkan path -->
  <link rel="manifest" href="./manifest.json">
  <link rel="stylesheet" href="./assets/css/style.css">
  <link rel="stylesheet" href="./assets/css/redesign_dark.css">
  <link rel="icon" href="./assets/icons/favicon.svg" type="image/svg+xml">

  <script src="https://apis.google.com/js/api.js"></script>
  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <style>
    body { font-family: 'Segoe UI', sans-serif; margin:0; background:#0b0c10; color:#e6e7e9; }
    .header { background:#FFD700; color:#000; padding:10px 20px; display:flex; align-items:center; gap:12px; }
    .brand img { height:48px; }
    .brand .main { font-weight:700; font-size:1.2rem; }
    .brand .sub { font-size:0.9rem; opacity:0.8; }
    .container { padding:20px; }
    .controls button { margin:4px; cursor:pointer; }
    .card-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(160px,1fr)); gap:10px; margin-top:20px; }
    .card { background:#1b1e24; padding:20px; border-radius:10px; text-align:center; }
    section.page { display:none; animation: fadeIn 0.3s ease; }
    section.active { display:block; }
    @keyframes fadeIn { from {opacity:0;} to {opacity:1;} }

    footer { margin-top:20px;text-align:center;opacity:0.7; }

    /* GDrive & Notif UI */
    #gdrive-ui { position:fixed; right:12px; bottom:12px; z-index:9999; display:flex; gap:8px; flex-wrap:wrap; }
    button.gbtn { padding:10px 14px; border:none; border-radius:8px; font-weight:600; cursor:pointer; transition: all 0.2s ease; }
    button.gbtn:hover { opacity: 0.9; transform: translateY(-1px); }
    button.connect { background:#1a73e8; color:white; }
    button.backup { background:#34a853; color:white; }
    button.restore { background:#fbbc05; color:#000; }
    button.logout { background:#ea4335; color:white; }

    #notifyBox { position: fixed; right: 20px; bottom: 20px; z-index: 10000; display: flex; flex-direction: column; gap: 10px; font-family: "Segoe UI", sans-serif; }
    .notify { padding: 12px 16px; border-radius: 10px; color: #fff; font-weight: 600; min-width: 220px; box-shadow: 0 4px 10px rgba(0,0,0,0.3); opacity: 0; transform: translateY(20px); transition: all 0.3s ease; }
    .notify.show { opacity: 1; transform: translateY(0); }
    .notify.success { background: #34a853; }
    .notify.error { background: #ea4335; }
    .notify.info { background: #1a73e8; }
  </style>
</head>

<body>
  <div class="header">
    <div class="brand">
      <img src="./assets/logo.png" alt="logo">
      <div class="title">
        <div class="main">An-Naas Kelulut Bekeng</div>
        <div class="sub">Premium Kelulut Honey Management</div>
      </div>
    </div>
  </div>

  <div class="container">
    <!-- ✅ Tukar semua butang ke SPA navigation -->
    <div class="controls">
      <button onclick="showPage('dashboard')">Dashboard</button>
      <button onclick="showPage('colonies')">Koloni</button>
      <button onclick="showPage('harvests')">Hasil</button>
      <button onclick="showPage('care')">Penjagaan</button>
      <button onclick="showPage('reports')">Laporan</button>
      <button onclick="showPage('sales')">Jualan</button>
      <button onclick="showPage('inventory')">Stok</button>
      <button onclick="showPage('invoices')">Invois</button>
      <button onclick="showPage('charts')">Graf</button>
      <span id="driveStatus" style="margin-left:12px">Drive: Disconnected ❌</span>
    </div>

    <!-- ✅ Setiap page dalam satu section -->
    <section id="dashboard" class="page active">
      <h2>Dashboard</h2>
      <div class="card-grid">
        <div class="card"><strong id="countColonies">0</strong><div>Jumlah Koloni</div></div>
        <div class="card"><strong id="totalHarvest">0</strong><div>Jumlah Hasil (kg)</div></div>
        <div class="card"><strong id="monthlySales">0</strong><div>Jualan Bulanan (RM)</div></div>
        <div class="card"><strong id="dueCare">0</strong><div>Penjagaan Hari Ini</div></div>
      </div>
    </section>

    <section id="colonies" class="page"><h2>Koloni</h2><p>Senarai koloni lebah kelulut anda.</p></section>
    <section id="harvests" class="page"><h2>Hasil</h2><p>Rekod hasil madu kelulut.</p></section>
    <section id="care" class="page"><h2>Penjagaan</h2><p>Jadual penjagaan dan penyelenggaraan koloni.</p></section>
    <section id="reports" class="page"><h2>Laporan</h2><p>Analisis data dan laporan mingguan/bulanan.</p></section>
    <section id="sales" class="page"><h2>Jualan</h2><p>Urus jualan madu dan hasil kelulut.</p></section>
    <section id="inventory" class="page"><h2>Stok</h2><p>Pantau inventori dan stok botol.</p></section>
    <section id="invoices" class="page"><h2>Invois</h2><p>Senarai invois pelanggan.</p></section>
    <section id="charts" class="page"><h2>Graf</h2><p>Paparan visual graf hasil dan jualan.</p></section>

    <footer>Kelulut Management System</footer>
  </div>

  <!-- ✅ Google Drive UI -->
  <div id="gdrive-ui">
    <button class="gbtn connect" onclick="manualConnect()">Connect Google Drive</button>
    <button class="gbtn backup" onclick="manualBackup()">Backup Now</button>
    <button class="gbtn restore" onclick="manualRestore()">Restore</button>
    <button class="gbtn logout" onclick="manualSignOut()">Logout</button>
  </div>

  <div id="notifyBox"></div>

  <!-- ✅ JS -->
  <script src="./js/db.js"></script>
  <script src="./js/main.js"></script>

  <script>
    // SPA Navigation
    function showPage(pageId) {
      document.querySelectorAll("section.page").forEach(sec => sec.classList.remove("active"));
      document.getElementById(pageId).classList.add("active");
      window.scrollTo(0, 0);
    }

    // Register Service Worker
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("./service-worker.js").catch(()=>{});
    }
  </script>
</body>
</html>